# K3dev Configuration
# Copy this file to one of the following locations:
#   - ./k3dev.yml (current directory)
#   - ~/.config/k3dev/config.yml (recommended)
#   - /etc/k3dev/config.yml (system-wide)

# =============================================================================
# Cluster Connection Settings
# =============================================================================
cluster:
  # Path to kubeconfig (optional, defaults to ~/.kube/config)
  kubeconfig: ""
  # Kubernetes context to use (optional, defaults to current context)
  context: ""

# =============================================================================
# Infrastructure Settings
# =============================================================================
infrastructure:
  # Cluster name (used to derive container and network names)
  # Container name will be: {cluster_name}-server
  # Network name will be: {cluster_name}-net
  cluster_name: "k3dev"

  # Domain for local cluster ingresses
  domain: "myapp.local"

  # K3s version
  k3s_version: "v1.33.4-k3s1"

  # Ports
  api_port: 6443
  http_port: 80
  https_port: 443

  # =============================================================================
  # Speedup Optimizations (optional)
  # =============================================================================
  # Snapshots are ENABLED BY DEFAULT for optimal performance.
  # Uncomment and set to 'false' to disable if needed.
  #
  # speedup:
  #   # Enable snapshot-based startup for faster subsequent starts
  #   # When enabled (default):
  #   # - First start: Normal speed (~30-60s), creates a snapshot
  #   # - Subsequent starts: Much faster (~5-10s), uses the snapshot
  #   #
  #   # Snapshots are automatically invalidated when config changes (k3s version,
  #   # domain, ports, etc.), ensuring consistency across cluster restarts.
  #   use_snapshot: true  # DEFAULT: true
  #
  #   # Automatically cleanup old snapshots when creating new ones
  #   # Only keeps the snapshot matching current config
  #   snapshot_auto_cleanup: true  # DEFAULT: true

# =============================================================================
# Logging Configuration (optional)
# =============================================================================
logging:
  # Enable file logging
  enabled: true

  # Log file path (supports {cluster_name} placeholder)
  # The {cluster_name} placeholder is replaced with the actual cluster name
  file: "/tmp/k3dev-{cluster_name}.log"

  # Log level: trace, debug, info, warn, error
  level: "info"

# =============================================================================
# Placeholders (optional)
# Define reusable values referenced as @placeholder_name
# =============================================================================
placeholders:
  ns: "default"
  app_selector: "app=myapp"

# =============================================================================
# Custom Commands
# =============================================================================
commands:
  - name: "App"
    commands:
      - name: "Shell"
        exec:
          target:
            namespace: "@ns"
            selector: "@app_selector"
          cmd: "/bin/sh"

      - name: "View Logs"
        exec:
          target:
            namespace: "@ns"
            selector: "@app_selector"
          cmd: "tail -f /var/log/app.log"

      - name: "Custom Command"
        exec:
          target:
            namespace: "@ns"
            selector: "@app_selector"
          cmd: "@command"
          input:
            command: "Enter command:"
